<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title></title>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<script src="libs/navigation-1.1/codefolding.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, target-densityDpi=device-dpi" />
<meta name="format-detection" content="telephone=no" />
<script src="libs/exploratory/resources/d3.min.js?cb=cb1667694571736"></script>
<script src="libs/exploratory/resources/viz.min.js?cb=cb1667694571736"></script>
<script src="libs/exploratory/resources/chroma.min.js?cb=cb1667694571736"></script>
<script src="libs/exploratory/resources/showdown.min.js?cb=cb1667694571736"></script>
<script src="libs/exploratory/resources/jquery.balloon.min.js?cb=cb1667694571736"></script>
<link href="libs/exploratory/resources/viz-base.css?cb=cb1667694571736" rel="stylesheet"></link>
<script src="libs/exploratory/resources/plotly.min.js?cb=cb1667694571736"></script>
<script src="libs/exploratory/resources/plotly-locale-ja.js?cb=cb1667694571736"></script>
<link href="libs/exploratory/resources/plotly-custom.css?cb=cb1667694571736" rel="stylesheet"></link>
<link href="libs/exploratory/resources/pivot.css?cb=cb1667694571736" rel="stylesheet"></link>

<style  type="text/css">
  /* pivot adjustment */
  .pivot-metainfo {
    display:none;
  }
  .viz-container {
   -webkit-font-smoothing: antialiased;
   -moz-osx-font-smoothing: grayscale;
  }
</style>
<script src="libs/exploratory\layout\NVg6DEl4.js"></script>
<script src="libs/exploratory\layout\wXn7VSG6.js"></script>
<script src="libs/exploratory\layout\YHl1wNp1.js"></script>
<script src="libs/exploratory\layout\sMm8ZvD6.js"></script>
<script src="libs/exploratory\layout\SVz0ocH1.js"></script>
<script src="libs/exploratory\layout\drl8gZV3.js"></script>
<script src="libs/exploratory\layout\qHV1Lfv9.js"></script>
<script src="libs/exploratory\layout\GMF7Xyn1.js"></script>
<script src="libs/exploratory\layout\QPN6FEJ8.js"></script>
<script src="libs/exploratory\layout\JSt5xgi2.js"></script>
<script src="libs/exploratory\layout\rTO9vio8.js"></script>
<script src="libs/exploratory\layout\lrX9EyJ0.js"></script>
<script src="libs/exploratory\layout\FoN1Htl6.js"></script>
<script src="libs/exploratory\layout\tsx7QGQ6.js"></script>
<script src="libs/exploratory\layout\hTP3irA9.js"></script>
<script src="libs/exploratory\layout\moi2jDi3.js"></script>
<script src="libs/exploratory\layout\sBf6QVi5.js"></script>
<script src="libs/exploratory\layout\eGe2NCZ2.js"></script>
<script src="libs/exploratory\analytics\UhO1nUh0.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs/exploratory/resources/note-base.css?cb=20221106T002931609Z" type="text/css" />
<link rel="stylesheet" href="libs/exploratory/resources/microtip.css?cb=20221106T002931609Z" type="text/css" />
<link rel="stylesheet" href="libs/exploratory/resources/note-mobile.css?cb=20221106T002931609Z" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        // adding '_' for the hash. Somehow single word without special chars corrupts the layout.
        return '_'+text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


div.toc-content {
  padding-left: 80px;
  padding-right: 40px;
  max-width:820px; /* 700px (main body width) + padding left/right */ 
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
  div.toc-content {
    padding-left: 40px;
    padding-right: 40px;
    max-width:770px; /* 700px (main body width) + padding left/right */ 
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
  div.toc-content {
    width: 100%;
    padding-left: 15px;
    padding-right: 15px;
    max-width:none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">



<style type="text/css">
/* Styles for plain html output with 2-column layout, which is 
   with TOC floating on the left hand side case.  */ 
.main-container {
}

/* Adjust toc styles */
.tocify-subheader .tocify-item {
  padding-left: 15px;
}
/* h3 and lower headers */
.tocify-subheader .tocify-subheader .tocify-item {
  padding-left: 30px;
}
/* override TOC default top margin */
#TOC {
  margin-top: 48px;
  padding-right:20px;
  color: #444659;
}
@media (max-width: 768px) {
  /* shorter top margin for mobile */
  #TOC { 
    margin-top:25px; padding-right:0px;
  }
}

/* Div surrounding the TOC. */
@media (min-width: 768px) {
  .col-xs-12.col-sm-4.col-md-3 {
    /* Avoid the content overlapping TOC on safari if you zoom out #18209 */
    height: 10px;
  }
}

</style>

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>




</div>


<div id="analysis-of-credit-card-defaulters" class="section level1">
<h1><span class="header-section-number">1</span> Analysis of Credit Card Defaulters</h1>
<p>This project is dealing with univariate and bivariate analysis and crosstab function then investigating theSperman correlation between all variables. Finally, we will build a customer profie for making better informed decision. You can access and download data by <a href="https://archive.ics.uci.edu/ml/machine-learning-databases/00350/default%20of%20credit%20card%20clients.xls">clicking here</a></p>
</div>
<div id="dictonary-of-data" class="section level1">
<h1><span class="header-section-number">2</span> Dictonary of data</h1>
<div class="figure">
<img src="libs/exploratory/images/p1.png" />

</div>
</div>
<div id="checking-the-data" class="section level1">
<h1><span class="header-section-number">3</span> Checking the data</h1>
<div id="the-required-packages-to-perform-such-analysis" class="section level2">
<h2><span class="header-section-number">3.1</span> The required packages to perform such analysis</h2>
<pre><code>
# Load required packages.
library(lubridate)
library(tidyr)
library(stringr)
library(readr)
library(cpp11)
library(forcats)
library(RcppRoll)
library(dplyr)
library(tidyverse)</code></pre>
</div>
<div id="number-of-entries" class="section level2">
<h2><span class="header-section-number">3.2</span> Number of entries</h2>
<div id="this-data-has-30000-entries-and-25-variables" class="section level3">
<h3><span class="header-section-number">3.2.1</span> This data has 30,000 entries and 25 variables</h3>
<script data-id="viz_1" data-object-name="viz_NVg6DEl4" data-viz="NVg6DEl4" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_1" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>Sample of data</p>
</div>
</div>
<div id="sample" class="section level2">
<h2><span class="header-section-number">3.3</span> Sample</h2>
<script data-id="viz_2" data-object-name="viz_wXn7VSG6" data-viz="wXn7VSG6" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_2" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>Now, we will check for NA values</p>
</div>
<div id="checking-of-na-values" class="section level2">
<h2><span class="header-section-number">3.4</span> Checking of NA values</h2>
<pre><code>  summarize_group(group_cols = NULL, group_funs = NULL,across(is.numeric,  ~ na_count(.x)))</code></pre>
<script data-id="viz_3" data-object-name="viz_YHl1wNp1" data-viz="YHl1wNp1" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_3" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
</div>
</div>
<div id="data-preprocessing" class="section level1">
<h1><span class="header-section-number">4</span> Data Preprocessing</h1>
<div id="getting-unique-count-for-variables" class="section level2">
<h2><span class="header-section-number">4.1</span> Getting unique count for variables</h2>
<p>Let's figure out the unique count for all of these features</p>
<script data-id="viz_4" data-object-name="viz_sMm8ZvD6" data-viz="sMm8ZvD6" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_4" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
</div>
<div id="manipulation-of-the-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Manipulation of the data</h2>
<div id="redesign-education-column" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Redesign Education column</h3>
<p>The education already has 7 uniques values, we will adjust its subcategory into only 4 ones as stated in the description. The R code is</p>
<pre><code>  %&gt;% mutate(EDUCATION = recode(EDUCATION, `0` = 4, `1` = 1, `2` = 2, `3` = 3, `4` = 4, `5` = 4, `6` = 4)) 
</code></pre>
<p>the output is Education [1, 2, 3, 4]</p>
<p>Similarly, we are going to readjust 'marriage' subcategory</p>
<pre><code>  %&gt;% mutate(MARRIAGE = recode(MARRIAGE, `0` = 2, `1` = 1, `2` = 2, `3` = 3)) 
</code></pre>
<p>Finally, renaming PAY_0 into PAY_1 and default as well</p>
<pre><code>  rename(PAY_1 = PAY_0, DEFAULT = default_payment_next_month) %&gt;%</code></pre>
</div>
</div>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1><span class="header-section-number">5</span> Exploratory data analysis</h1>
<p>In this phase, we will investigate the 1. Univariate analysis 2. Bivariate analysis 3. Correlation</p>
<div id="univariate-analysis" class="section level2">
<h2><span class="header-section-number">5.1</span> Univariate analysis</h2>
<p>Univariate analysis is the simplest form of analysis where we analyze each feature and try to uncover the pattern or distribution of the data.</p>
<div id="count-plot-for-the-deafult-payment-column" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Count plot for the Deafult payment column</h3>
<script data-id="viz_5" data-object-name="viz_SVz0ocH1" data-viz="SVz0ocH1" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_5" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>We see that 6636 customers have defaulted out of 30000 people, around 22%</p>
</div>
<div id="sex" class="section level3">
<h3><span class="header-section-number">5.1.2</span> SEX</h3>
<script data-id="viz_6" data-object-name="viz_drl8gZV3" data-viz="drl8gZV3" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_6" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>A total of 18112 females and 11888 males in this dataset.</p>
</div>
<div id="education" class="section level3">
<h3><span class="header-section-number">5.1.3</span> EDUCATION</h3>
<p>These subcategories represent the highest qualification of education <img src="libs/exploratory/images/p2.png" /></p>
<script data-id="viz_7" data-object-name="viz_qHV1Lfv9" data-viz="qHV1Lfv9" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_7" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>Let's check the exact count and percentage</p>
</div>
<div id="highest-education-count" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Highest education count</h3>
<p><script data-id="viz_8" data-object-name="viz_GMF7Xyn1" data-viz="GMF7Xyn1" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_8" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div> we spot that customers either went to school or universities.</p>
</div>
<div id="marriage" class="section level3">
<h3><span class="header-section-number">5.1.5</span> MARRIAGE</h3>
<script data-id="viz_9" data-object-name="viz_QPN6FEJ8" data-viz="QPN6FEJ8" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_9" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>The highest percentage of customers is single, then people who are married.</p>
<hr />
</div>
</div>
<div id="bivariate-analysis" class="section level2">
<h2><span class="header-section-number">5.2</span> Bivariate analysis</h2>
<p>Bivariate analysis is done between two variables to detect the relationship,if applicable.</p>
<div id="relationship-between-the-sex-and-default-columns" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Relationship between the SEX and DEFAULT columns</h3>
<script data-id="viz_10" data-object-name="viz_JSt5xgi2" data-viz="JSt5xgi2" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_10" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>Now, we will perform some cross-tabulation which is useful to see the distribution and extracting insights.</p>
</div>
<div id="cross-tabulation-for-the-sex-and-default-columns" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Cross-tabulation for the SEX and DEFAULT columns</h3>
<script data-id="viz_11" data-object-name="viz_rTO9vio8" data-viz="rTO9vio8" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_11" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>Who have defaulted from customers? Around 24% of male and 20% of female customers have defaulted.</p>
</div>
<div id="relationship-between-the-education-and-default-columns" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Relationship between the EDUCATION and DEFAULT columns</h3>
<p><script data-id="viz_12" data-object-name="viz_lrX9EyJ0" data-viz="lrX9EyJ0" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_12" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div> Look at this! People who have the highest degree is university have defaulted the most. And to detect which subcategory has a higher default, we perform cross-tabulation</p>
</div>
<div id="cross-tabulation-of-the-default-and-education-columns" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Cross-tabulation of the DEFAULT and EDUCATION columns</h3>
<script data-id="viz_13" data-object-name="viz_FoN1Htl6" data-viz="FoN1Htl6" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_13" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
</div>
<div id="relationship-between-the-marriage-and-default-columns-1" class="section level3">
<h3><span class="header-section-number">5.2.5</span> Relationship between the MARRIAGE and DEFAULT columns-1</h3>
<script data-id="viz_14" data-object-name="viz_tsx7QGQ6" data-viz="tsx7QGQ6" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_14" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>We see that single have the highest number of defaults. Let's check the percentage</p>
</div>
<div id="cross-tabulation-between-the-default-and-marriage-columns" class="section level3">
<h3><span class="header-section-number">5.2.6</span> Cross-tabulation between the DEFAULT and MARRIAGE columns</h3>
<p><script data-id="viz_15" data-object-name="viz_hTP3irA9" data-viz="hTP3irA9" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_15" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div> So, cross-tabulation has been helpful in detecting and investigating the subcategories.</p>
</div>
</div>
<div id="pay_1-versus-default" class="section level2">
<h2><span class="header-section-number">5.3</span> PAY_1 versus DEFAULT</h2>
<p>Now, we check if there is relationship between these two variables. The measurement scale for the repayment status is: <img src="libs/exploratory/images/p3.png" /></p>
<p>Again, we use cross-tabulation to see the pattern here</p>
<div id="cross-tabulation-for-the-pay_1-and-default-columns" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Cross-tabulation for the PAY_1 and DEFAULT columns</h3>
<p><script data-id="viz_16" data-object-name="viz_moi2jDi3" data-viz="moi2jDi3" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_16" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div> The highest number of defaults is under the subcategory 2, which means that customers who have missed the payment have a high probability of default.</p>
</div>
<div id="relationship-between-the-limit_bal-and-default-column" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Relationship between the LIMIT_BAL and DEFAULT column</h3>
<script data-id="viz_17" data-object-name="viz_sBf6QVi5" data-viz="sBf6QVi5" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_17" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>Customers who high balance amount are less likely to default when compared to customers with lower balance.</p>
</div>
<div id="relationship-between-the-age-and-default-columns" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Relationship between the AGE and DEFAULT columns</h3>
<p>Again, the magic crosstab.</p>
<script data-id="viz_18" data-object-name="viz_eGe2NCZ2" data-viz="eGe2NCZ2" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="viz_18" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>From the previous output, we can see that ages 27 and 29 had higher of defaults.</p>
</div>
</div>
</div>
<div id="correlation" class="section level1">
<h1><span class="header-section-number">6</span> Correlation</h1>
<p>In this section, we perform correlation analysis using spearman to detect the relationship between all the variables.</p>
<div id="heatmap-for-spearmans-rank-correlation---correlations" class="section level3">
<h3><span class="header-section-number">6.0.1</span> Heatmap for Spearman's rank correlation - Correlations</h3>
<script data-id="analytics_19" data-object-name="analytics_UhO1nUh0" data-viz="heatmap" data-analysis="UhO1nUh0" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="analytics_19" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
</div>
<div id="heatmap-for-spearmans-rank-correlation---significance" class="section level3">
<h3><span class="header-section-number">6.0.2</span> Heatmap for Spearman's rank correlation - Significance</h3>
<script data-id="analytics_20" data-object-name="analytics_UhO1nUh0" data-viz="significance" data-analysis="UhO1nUh0" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="analytics_20" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>AND, to check the correlation between DEFAULT and other variables</p>
</div>
<div id="heatmap-for-spearmans-rank-correlation---data" class="section level3">
<h3><span class="header-section-number">6.0.3</span> Heatmap for Spearman's rank correlation - Data</h3>
<script data-id="analytics_21" data-object-name="analytics_UhO1nUh0" data-viz="table" data-analysis="UhO1nUh0" data-height="normal" data-width="normal" data-fit="" ></script><div data-id="analytics_21" style="width:100%; height:400px; display:table;margin-bottom:38px" class="viz-rendering-error viz-loading"><div style="width:100%; height:100%; display:table-cell; vertical-align:middle; text-align:center; font-size:14px; color:#999; background-color:white;font-family:sans-serif "><div>Loading... </div></div></div>
<p>So, what can we conclude? Well, the default colums has positive correlation with PAY_1, which means that if a customer miss the first payment, he is more likely to miss the next payment. In addition, there is a negative correlation between default and PAY_AMT1, which implies that the higher the payment for the month of September 2005, the lower the chances of defaults.</p>
</div>
</div>
<div id="building-a-profile-of-a-high-risk-customer" class="section level1">
<h1><span class="header-section-number">7</span> Building a Profile of a High-Risk Customer</h1>
<ol style="list-style-type: decimal">
<li>Males customers are at high rist of default more than females.</li>
<li>People with 'other' relationship are more likely to default than single or married people.</li>
<li>In terms of education level, the highest level of education is a high-school diploma, they are at risk of defaults.</li>
<li>People who have delayed their payment for more than 2 consecutive months have higher probability of defaults.</li>
<li>Among age groups, the age 22 is the highest age of default.</li>
</ol>
</div>
<div id="summary" class="section level1">
<h1><span class="header-section-number">8</span> Summary</h1>
<p>In this project, we have used the univariat analysis to detect the distribution then also have performed the bivariate analysis to see the relationship among two variables. Finally, we have also investigated the spearman correlation among all variables.</p>
</div>

<!-- BEGIN: Exploratory custom footer -->
<dialog id="download-img-modal">
  <form method="dialog">
    <div class="download-img-modal-title" data-label="Export Chart Image">Export Chart Image</div>
    <div class="download-img-modal-body">
      <div class="label-row" data-label="Output Format">
        Output Format
      </div>
      <div class="value-row">
        <input type="radio" name="download-img-type" id="download-img-type-png" value="png" checked/><span class="radio-label">PNG</span>
        <input type="radio" name="download-img-type" id="download-img-type-svg" value="svg"/><span class="radio-label">SVG</span>
      </div>
      <div class="label-row" data-label="Background">
        Background
      </div>
      <div class="value-row">
        <input type="checkbox" id="download-img-transparent"/>
        <span class="cb-label" data-label="Set background transparent">Set background transparent</span>
      </div>
      <div class="label-row" data-label="Size">
        Size
      </div>
      <div class="value-row">
        <div class="size-box">
          <div class="sub-label-row" data-label="Width (Pixel)">Width (Pixel)</div>
          <div><input id="download-img-width" type="number" value="" placeholder="1200"/></div>
        </div>
        <div class="size-box">
          <div class="sub-label-row" data-label="Height (Pixel)">Height (Pixel)</div>
          <div><input id="download-img-height" type="number" value="" placeholder="Auto" /></div>
        </div>
        <div class="size-box-small">
          <div class="sub-label-row" data-label="Pixel Ratio">Pixel Ratio</div>
          <div>
            <select id="download-img-ratio">
              <option value="1">100%</option>
              <option value="1.5">150%</option>
              <option value="2" selected>200%</option>
              <option value="2.5">250%</option>
              <option value="3">300%</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="download-img-modal-footer">
      <button id="download-img-ok-btn" value="default" data-label="Export">Export</button>
      <button id="download-img-cancel-btn" value="cancel" data-label="Cancel">Cancel</button>
    </div>
  </form>
</dialog>

<script>

var FULL_WIDTH_MARGIN_SIDE = 60;
var $body = $(document.body);
var screenWidth = $body.width();
var openOnDesktop = window.location.href.indexOf("desktop=true") > -1; 
var openInLocal = window.location.href.startsWith("file:"); 
var enableChartDataDownload = !openInLocal && !openOnDesktop && window.parent && window.parent.document && !!window.parent.document.querySelector('input#enable-csv-download');
var enableChartImageDownload = !openInLocal && !openOnDesktop;
if (openOnDesktop) { // enable chart data/image download on desktop.
 enableChartDataDownload = true;
 enableChartImageDownload = true;
}

// Translate the chart image download dialog.
var lang = document.documentElement.lang || null;
if (lang) {
  // Translate span/div with "data-label" attr.
  var labels = document.querySelectorAll("#download-img-modal [data-label]");
  labels.forEach(function(l) {
    l.innerText = VizUtil.getMessage(lang, l.dataset.label);
  });
  // Translate input field placeholder
  document
    .querySelector("#download-img-modal #download-img-height")
    .setAttribute("placeholder", VizUtil.getMessage(lang, "Auto"));
}
// Add event to the ok button in the chart image download dialog.
$("#download-img-ok-btn").on("click", function(ev){
  var id = this.dataset.id;
  var objectName = this.dataset.objectName;
  var vizName = this.dataset.vizName;
  var chartTitleForDownload = this.dataset.chartTitleForDownload;
  var format = $("#download-img-type-png").is(":checked") ? "png" : "svg";
  var useTransparentBackground = $("#download-img-transparent").is(":checked");
  var width = $("#download-img-width").val();
  var height = $("#download-img-height").val();
  var scale = $("#download-img-ratio").find(":selected").val();
  var _downloadSnapshotCb = function(datauri, id, objectName, vizName) {
    try {
      var _a = document.createElement('a');
      _a.style.display = 'none';
      _a.style.position= 'absolute';
      _a.href = datauri;
      // the filename you want
      _a.download = chartTitleForDownload + '.' + format;
      document.body.appendChild(_a);
      _a.click();
    } catch(e) {
      console.log("Downloading chart image failed: ",e.message, id, objectName, vizName);
    }
  }
  if (id && objectName && vizName) {
    _generateSnapshot(id, objectName, vizName, _downloadSnapshotCb, format, useTransparentBackground, width, height, scale);
  }
});


// The default body max-width is set to 782px so if it is less than 902px 
// (782 + 60 left margin + 60 right margin) we cancel stretching images. 
$('img[width="full"]').each(function() {
  var $elem = $(this);
  if (screenWidth > 902) {
    $elem.attr("width", "");  // remove "full"
    var elemOffsetLeft = $elem.offset().left;
    $elem.css({"width": (screenWidth - (FULL_WIDTH_MARGIN_SIDE*2) )+'px', "max-width": (screenWidth - (FULL_WIDTH_MARGIN_SIDE*2) )+'px', "margin-left": (-1 *(elemOffsetLeft - FULL_WIDTH_MARGIN_SIDE)) + "px" });
  } else {
    $elem.attr("width", "100%"); // replace "full" with "100%"
  }
});

$('a').each(function(index, a){
  var $link = $(this);
  if($link.attr('href') && !$link.attr('href').startsWith('file')){// tab has a with href="file" so exclude tab
    $link.attr('target','_blank'); // make sure link opens another tab or window.
  }
});

var _enableLinks = function() {
  if (!openOnDesktop) {
    return false;
  }
  $('a').each(function(index, a){
    var $link = $(this);
    // Enable links starting with http* and mailto. Others are used for 
    // other purpose such as map, tab, etc so don't touch those. 
    if($link.attr('href') && /^(http:\/\/|https:\/\/|mailto:)/.test($link.attr('href'))){
      $link.off("click");
      $link.on("click", function (e) {
        e.preventDefault(); // make sure to block default to avoid external content rendered inside Exploratory Desktop.
        window.parent.postMessage(JSON.stringify({action:'OpenExternalLink', url: $link.attr('href')}),'*');
        //MarkdownActions.openExternalLink($link.attr('href'));
      });
    }
  });
};

var onMessageReceiveHandler = function(event){
  var data = null;   
  try {
    data = JSON.parse(event.data);
  } catch(e) {
    // The event.data may be just a text like 'ready'. 
    // We ignore those cases. 
  }
  if (!data) {
    return;
  }
  if(data.action) {
    switch(data.action) {
      case "ScrollY":
        window.scrollTo(0, data.scrollY);
        break;
      case "EnableLinks":
        _enableLinks();
        break;
    }
  }

}
window.addEventListener('message', onMessageReceiveHandler, false); 

var ready = function(){
  window.parent.postMessage(JSON.stringify({action:'DocumentReady'}),'*');
}
document.addEventListener("DOMContentLoaded", ready);

</script>

<script>


// Find exploratory vizs. Check the existence of 'data-id' and 'data-viz' attributes. 
var $vizs = $("script[data-id][data-viz]");
// View area width. 
var screenWidth = $(document.body).width();
// View area height. 
var screenHeight = $(window).height();

// In case of shared note, the note is loaded in the iframe so the screen
// height is shorter than the actual screen size so we need to adjust it.
// Accessing the parent fails if you open it locally (including opening on desktop) 
// because of the cross origin so just to check. 
if (!/^file:/.test(window.location.href)) {
  var offset = $(window.parent.document).find("iframe.markdown-content-frame").offset();
  if (offset && offset.top) {
    screenHeight+=offset.top;
  }
}


// Capturing charts/analytics snapshot images for Word output and 
// self-contained HTML output.  (self-contained HTML output is not used now.)
var _generateSnapshot = function(id, objectName, vizName, cb, format, useTransparentBackground, width, height, scale) {
  if (!cb) {
    // Dummy callback.
    cb = function() {};
  }
  var analyticsName = null;

  var viz = window[objectName];
  if (!window._datauris) 
    window._datauris = {};
      
  // If it is analytics, find the viz metadata in analytics json.
  if (/^analytics_/.test(id)) {
    // If no corresponding metadata found, just return. 
    if (!viz.vizs[vizName]) {
      cb(null, id, objectName, vizName);
      return;
    }
    analyticsName = viz.name;
    viz = viz.vizs[vizName].metadata;
  }

  if (VizUtil.isPivot(viz.options.marker)) {
      // do nothing.
      cb(null, id, objectName, vizName);
  } else if (VizUtil.isLeaflet(viz.options.marker)) {
    var map = window._leaflet_map_objs[id];
    var options = {
      exclude: ['.leaflet-control-zoom', '.leaflet-control-attribution', '.info-box'],
      format: 'image/png'
    };
    return map.export(options)
    .then(function(res) {
      window._datauris[id] = res ? res.data : "null";
      cb(res ? res.data : null, id, objectName, vizName);
      return null;
    })
    .catch(function(e){
      window._datauris[id] = "null";
      cb(null, id, objectName, vizName);
    });
  } else if (VizUtil.isROutput(viz.options.marker)) {
    cb(null, id, objectName, vizName); 
  } else if (VizUtil.isPlotly(viz.options.marker)) {
    // plotly
    var graphDiv = document.querySelector('div[data-id="div-'+id+'"] .js-plotly-plot');
    var origw = graphDiv.clientWidth;
    var origh = graphDiv.scrollHeight;
    var _width = width || 1200; 
    var _height = height || (graphDiv.scrollHeight > graphDiv.clientHeight ? _width * origh / origw : 800);
    var _format = format || "png";
    var _scale = scale || "2";
    // Set the background color. 
    graphDiv.layout.paper_bgcolor = useTransparentBackground ? 'rgba(255,255,255,0)' : 'rgba(255,255,255,1)';
    graphDiv.layout.plot_bgcolor = useTransparentBackground ? 'rgba(255,255,255,0)' : 'rgba(255,255,255,1)';

    return Plotly.toImage(graphDiv,  {format: _format, width: _width, height: _height, scale: _scale})
    .then(function(res){
      window._datauris[id] = !!res ? res : "null";
      cb(res, id, objectName, vizName);
      // Use the width/height/scale used in the last export.
      // Save the width/height/scale for the next export.
      if (window.localStorage) {
        window.localStorage.setItem("exploratory.viz.width", width||null);
        window.localStorage.setItem("exploratory.viz.height", height||null);
        window.localStorage.setItem("exploratory.viz.scale", scale||null);
      }
    }) 
    .catch(function(e){
      window._datauris[id] = "null";
      cb(null, id, objectName, vizName);
    })
    .finally(function(){
      // Get back the background color white just in case. 
      graphDiv.layout.paper_bgcolor = 'rgba(255,255,255,1)';
      graphDiv.layout.plot_bgcolor = 'rgba(255,255,255,1)';
    });
  } else { // Shouldn't reach here, but just in case.
    cb(null, id, objectName, vizName);
  }
};


var _renderSingleViz = function($div, id, vizName, analyticsName, viz, minHeight) {
  var lang = document.documentElement.lang || null;
  var $parent = $div.parent();

  // Show no data message if data is empty. 
  // Some chart can render its own no data message so bypass for those cases. 
  if (VizUtil.shouldRenderNoData(viz.options.data, viz.options)) {
    // Show the query error message if available.
    VizUtil.renderNoData($div[0], viz.options._lastQueryErrorMessage, null, null, lang);
    // Mark it as rendered.
    window._vizRenderingStatus[id] = true;    
    return;
  }
  // Show detail handler on the server.
  var onShowDetailCallback = null;
  // Enable the show detail support on the following situations.
  // - Running on the desktop.
  // - Running on the server.
  // We don't support the show detail on the locally exported markdown.
  //
  // Disable the show detail on analytics charts for now because the chart
  // query is against the model output so it is hard to show the original data.
  if (!analyticsName && (openOnDesktop || !openInLocal)) {
      onShowDetailCallback = function(cdatalist) {
        var filterCondition = VizUtil.constructFilterConditions(cdatalist, viz.options);
        var _msg = {
          action: 'ShowDetail',
          condition: filterCondition,
          dataframeName: viz.transformName,
          marker: viz.options.marker,
          columns: viz.options.columns,
          vizName: viz.name,
          preprocessor: viz.preprocessor
        };
        if (openOnDesktop) {
          _msg = JSON.stringify(_msg);
        }
        window.parent.postMessage(_msg, '*');
      };
  }

  if (VizUtil.isPivot(viz.options.marker)) {
    // Render pivot table
    PivotTableGenerator.render(viz.options, viz.options.data, $div[0],
      null, null, lang, null, null, null, null, null, null, onShowDetailCallback);
    // adjust height 
    var pTitleHeight = $div.find('.pivot-title').outerHeight(true); 
    if ($div.find('.pivot-title').hasClass("hidden")) {
      pTitleHeight = 0;
    }
    var pColTitleHeight = $div.find('.pivot-col-title').outerHeight(true);
    if ($div.find('.pivot-col-title').hasClass("hidden")) {
      pColTitleHeight = 0;
    }
    var pToolbarHeight = $div.find('.pivot-toolbar').outerHeight(true);
    if ($div.find('.pivot-toolbar').hasClass("hidden")) {
      pToolbarHeight = 0;
    }
    var pHeaderHeight = $div.find('.pivot-table-frame.pivot-table-col-header-frame').outerHeight();
    var pBodyHeight = $div.find('.pivot-table-frame.pivot-table-body-frame').outerHeight();
    var horizScrollBarHeight = 18;
    var pHeight = pTitleHeight + pColTitleHeight + pHeaderHeight + pToolbarHeight + pBodyHeight + horizScrollBarHeight;
    //console.log(pTitleHeight + " " +pColTitleHeight + " " + pHeaderHeight + " " + pBodyHeight + " " + pHeight + " " + $div.height())
    if (viz.options.marker==="singlevalue"){
      $parent.css({'height':'120px', 'min-height':'120px'});
    } else {
      // Remove min-height for Table, Pivot, Summarize Table
      $parent.css({"min-height":""});
      // If the height is set to the div, adjust the height depending 
      // on the table actual height and min height. 
      // In case of "full" mode, there is no height set 
      // in order to show all rows so just ignore it. 
      if ($parent[0].style.height && minHeight) {
        $parent.height(Math.min(pHeight, minHeight));
      }
    }

  } else if (VizUtil.isLeaflet(viz.options.marker)) {
    // Render leaflet map
    switch (viz.options.marker) {
      case 'map':
      case 'maphmap':
        $parent.parent().parent().css({"background-color":"#fff"});
        MapGenerator.render(viz.options, viz.options.data, $div[0], 
        null, null, null, null, null, null, null, lang, onShowDetailCallback);
        break;
      case 'geojson':
        $parent.parent().parent().css({"background-color":"#fff"});
        var geojsonObjectName = 'geojson_' + viz.options.geojson; 
        MapGenerator.render(viz.options, viz.options.data, $div[0], window[geojsonObjectName],
          null, null, null, null, null, null, lang, onShowDetailCallback);
        break;
      case 'easymap':
        $parent.parent().parent().css({"background-color":"#fff"});
        var geojsonObjectName = 'geojson_' + viz.options.easymapMap; 
        MapGenerator.render(viz.options, viz.options.data, $div[0], window[geojsonObjectName],
          null, null, null, null, null, null, lang, onShowDetailCallback);
        break;
      default:
        break;
    }
  } else if (VizUtil.isROutput(viz.options.marker)) {
    // Locate the image in center.
    $parent.css({'text-align': 'center'});
    // Render R output
    ROutputGenerator.render(
      viz.options, 
      {"outputFile": [ (window._baseUrl ? window._baseUrl + "/note_content/" : "" ) + "libs/exploratory/layout_output/"+ (analyticsName ? analyticsName+"-" : "") + viz.name+".png"]}, 
      $div[0], 
      true,
      null,
      null,
      lang
    );
  } else if (VizUtil.isPlotly(viz.options.marker)) {
    // Show/Hide layout toolbar.
    viz.options.showFacetLayoutTool = window["exploratory-hide-chart-toolbars"] ? "off" : "on";
    // Render plotly graph
    $parent.css({"overflow-y":"auto"});
    PlotlyGraphGenerator.render(viz.options, viz.options.data, $div[0], true,
      null, null, null, null, null, onShowDetailCallback, null,
      // Pass dummy function to onPropUpdateCallback to enable toolbar.
      function(e){ return false; }, 
      lang);
  }
};

var _renderVizPanel = function() {
  var lang = document.documentElement.lang || null;
  var $elem = $(this); // This script tag
  var id = $elem.attr("data-id");
  var objectName = $elem.attr("data-object-name");
  // Hide loading placeholer
  // It could match multiple elements if there are same charts.
  $('.viz-loading[data-id="'+id+'"]').hide();
  // Backward compatibility. The rmarkdown renders the old cached data if available.
  $('.viz-rendering-error[id="loading-'+id+'"]').hide();
  
  var viz = window[objectName];
  var vizName = $elem.attr("data-viz");
  var analyticsName = null;
  var annotation = viz.annotation;
  // Check both viz.displayName and viz.options.displayName 
  // for the backward compatibility.
  var vizDisplayName = viz.displayName || viz.options.displayName;

  // If it is analytics, find the viz metadata in analytics json.
  if (/^analytics_/.test(id)) {
    if (viz.vizs[vizName]) {
      analyticsName = viz.name;
      var analyticsDisplayName = viz.displayName;
      viz = VizUtil.analyticify(viz.vizs[vizName].metadata);
      // Check both viz.displayName and viz.options.displayName 
      // for the backward compatibility.
      vizDisplayName = analyticsDisplayName + " - " + (viz.displayName || viz.options.displayName);
    } else {
      // If no metadata found, just set viz to null. 
      // Usually it shouldn't happen but just in case it happens. #9689
      viz = null;
    }
  }

  var containerWidth = $elem.parent().width();

  // The default body max-width: 782px. 
  // The default body width including margin: 902px (782 + 60(side margin) * 2), 
  var FULL_WIDTH_MARGIN_SIDE = screenWidth > 902 ? 60 : 0;  
  var FULL_HEIGHT_MARGIN_TOP = 10;  

  var isFullHeightMode = false;
  var isFullWidthMode = false;

  // User-specified height
  var userHeightStr = $elem.attr("data-height");
  var userHeight = null;
  if (userHeightStr) {
    if (userHeightStr==="full") {
      isFullHeightMode = true;
      userHeight = screenHeight  - FULL_HEIGHT_MARGIN_TOP;
    } else if (/%$/.test(userHeightStr)) {
      userHeight = parseInt(userHeightStr.replace("%",""));
      userHeight = isNaN(userHeight) ? null : (screenHeight * userHeight / 100) - FULL_HEIGHT_MARGIN_TOP;
    } else {
      userHeight = parseInt(userHeightStr.replace("px",""));
      userHeight = isNaN(userHeight) ? null : userHeight;
    }
  }
  // User-specified width
  var userWidthStr = $elem.attr("data-width");
  var userWidth = null;
  if (userWidthStr) {
    if (userWidthStr==="full") {
      isFullWidthMode = true;
      userWidth = screenWidth - FULL_WIDTH_MARGIN_SIDE*2;
    } else if (/%$/.test(userWidthStr)) {
      userWidth = parseInt(userWidthStr.replace("%",""));
      userWidth = isNaN(userWidth) ? null : (screenWidth * userWidth / 100) - (FULL_WIDTH_MARGIN_SIDE*2);
    } else {
      userWidth = parseInt(userWidthStr.replace("px",""));
      userWidth = isNaN(userWidth) ? null : userWidth;
    }
  }

  // Set the min height. If userHeight is available, just use it. 
  // If not, try to set a rectangle shape. Use landscape mode If the screen is 
  // large enough. If small (mobile case), use portrait mode.
  var minHeight = userHeight || (containerWidth<500 ? containerWidth*8/5 : containerWidth*5/8);

  // Insert a viz canvas div right after the script tag.
  // If there's already a div there (refresh case), do nothing.
  var $div = $('div[data-id="div-'+id+'"]');
  var $outerDiv = $div.parent();
  if ($div.length === 0) {
    $div = $("<div>").attr('data-id','div-'+id).css({"min-height":minHeight+"px", "margin-bottom":"38px" }).addClass("viz-container markdown-viz-container")   
    $outerDiv = $("<div>").addClass("viz-container-outer").append($div);
    $elem.after($outerDiv);
  }
  $div.show();

  // If viz is not available, render no data and exit. 
  if (!viz) {
    $div.height(minHeight);
    VizUtil.renderNoData($div[0], "No chart data found: "+vizName, null, null, lang);
    // Mark it as rendered.
    window._vizRenderingStatus[id] = true;  
    return;
  } 
 
  // Toolbar
  var $toolbarDiv = $outerDiv.find('.note-pane-toolbar'), $toolbarOuterDiv = null;
  if ($toolbarDiv.length === 0) {
    $toolbarDiv = $('<div class="note-pane-toolbar"/>');
    $toolbarOuterDiv = $('<div class="note-pane-toolbar-outer"/>');
    $outerDiv.prepend($toolbarOuterDiv.append($toolbarDiv));
  }
  var $toolbarOuterDiv = $toolbarDiv.parent();
 
  // Add a border to table/pivot
  if ( /^(table|pivot|summarytable)$/.test(viz.options.marker)) {
    $div.css({"border-radius":"3px", "border":"1px solid #f0f0f0", "padding":"4px 0px 0px 4px"});
  }
  // If plotly viz, add white background color to make viz visible on TOC
  // if the viz width="full".
  if (! /^(table|pivot|summarytable|map|maphmap|geojson|easymap)/.test(viz.options.marker)) {
    $div.css({"background-color": "#ffffff"});
  }

  var _generateSnapshotCb = function() {
    window.parent.postMessage(JSON.stringify({action:'SnapshotReady', datauris: window._datauris}),'*');
  };
  var $trigger = $("<a>")
    .attr({'data-id':'a-'+id, vizName, 'data-object-name':objectName})
    .addClass("viz-snapshot-trigger")
    .click(_generateSnapshot.bind(
      null,
      id,
      objectName,
      vizName,
      _generateSnapshotCb,
      null/*format*/,
      null/*useTransparentBackground*/,
      null/*width*/,
      null/*height*/,
      null/*scale*/
    ));

  $elem.after($trigger);   

  var divWidth  = $div.width(); 
  var divHeight = $div.height();
  var width = userWidth ||  divWidth;
  var height = userHeight || divHeight

  // If no scroll specified for height, not to set hight to let the div 
  // expand to fit the content without the vertical scrollbar. 

  // allow full height setting only if 
  // 1. the viz is either pivot or table, or 
  // 2. plotly chart with repeating.
  var allowFullHeight = !!viz.options.facet || /^(table|pivot|summarytable)$/.test(viz.options.marker);
  if (isFullHeightMode && allowFullHeight) {
    // In case of full height setting, not to specify height. 
  } else if (!userHeight && VizUtil.isROutput(viz.options.marker)) {
    // In case of R-based output chart and hight is not specified explicitly 
    // by user, not to set the height to use the full chart area div width. #14492. 
  } else {
    $div.css({'height': height+'px'});
  }

  $div.css({'width': width+'px'});
  $toolbarOuterDiv.css({'width': width+'px'});

  // If the width is given by user, adjust the left margin to locate the viz 
  // in the center. If it is in the full width mode, adjust the margin based 
  // on the screen size. 
  if (isFullWidthMode) {
    var marginLeft = (-1 * ($div.offset().left - FULL_WIDTH_MARGIN_SIDE)) + 'px';
    $div.css('margin-left', marginLeft);
    $toolbarOuterDiv.css('margin-left', marginLeft);
  } else if (userWidth && userWidth !== divWidth) {
    var marginLeft = ((userWidth - divWidth) / 2 * -1 ) + 'px';
    $div.css('margin-left', marginLeft);
    $toolbarOuterDiv.css('margin-left', marginLeft);
  }

  // in case of facet, make the viz width a bit smaller for the vert scroll bar. 
  viz.options.width = (!viz.options.facet ? width : width-20);
  viz.options.height= height;

  // Render a chart.
  var $innerDiv = $div.find('> .inner-div');
  if ($innerDiv.length === 0) {
    $innerDiv = $('<div class="inner-div" style="width:100%; height:100%">');
    $div.append($innerDiv);
  }
  _renderSingleViz($innerDiv, id, vizName, analyticsName, viz, minHeight);

  // Chart title for the "download" HTML attribute for chart data and image download.
  var chartTitleForDownload = vizDisplayName.replace('"', "&quot;");

  // Show comment button.
  var $commentBtn = null, commentHtml = null;
  if (viz.options.marker !== "singlevalue" && annotation && !document.querySelector('div.show-comment-btn[data-show-comment-id="'+id+'"]')) {
    var converter = new showdown.Converter();
    commentHtml = converter.makeHtml(annotation);
    $commentBtn = $('<div data-show-comment-id="'+id+'" class="show-comment-btn"></div>');
    $toolbarDiv.append($commentBtn);
  }

  // Download image button.
  var $downloadImgMenu = null;
  if (enableChartImageDownload && VizUtil.isPlotly(viz.options.marker) && !document.querySelector('a[data-image-download-id="'+id+'"]')) {
    $downloadImgMenu = $('<a data-image-download-id="'+id+'" href="">' + VizUtil.getMessage(lang, "Export Chart Image") + '</a>');
    $downloadImgMenu.on("click", function(ev){ 
      ev.preventDefault(); 
      // Set the chart info to the attributes of the ok button in the download image dialog.
      $("#download-img-ok-btn").attr({
        "data-id": id,
        "data-object-name": objectName,
        "data-viz-name": vizName,
        "data-chart-title-for-download": chartTitleForDownload
      });

      // Use the width/height/scale used in the last export.
      // Save the width/height/scale for the next export.
      if (window.localStorage) {
        var defaultWidth = window.localStorage.getItem("exploratory.viz.width");
        if (defaultWidth) {
          $("#download-img-width").val(defaultWidth);
        }
        var defaultHeight = window.localStorage.getItem("exploratory.viz.height");
        if (defaultHeight) {
          $("#download-img-height").val(defaultHeight);
        }
        var defaultScale = window.localStorage.getItem("exploratory.viz.scale");
        if (defaultScale) {
          $("#download-img-ratio").val(defaultScale);
        }
      }

      // Show the download image dialog.
      document.querySelector("#download-img-modal").showModal();
    });
  }

  // Download data button.
  var $downloadDataMenu = null;
  if (enableChartDataDownload && viz.options.marker !== "singlevalue" && !document.querySelector('a[data-download-id="'+id+'"]')) {
    if (openOnDesktop) {
      $downloadDataMenu = $('<a data-download-id="'+id+'" href="#">' + VizUtil.getMessage(lang, "Export Chart Data") + '</a>');
      $downloadDataMenu.on("click", function(ev){
        ev.preventDefault();
        ev.stopPropagation();
        window.parent.postMessage(JSON.stringify({action:'DownloadChartData', id: (analyticsName ? analyticsName + "_" : "")+viz.name, downloadFileName: chartTitleForDownload + ".csv", vizName: viz.name, analyticsName: analyticsName}),'*');
      });
    } else {
      // Use download HTML attribute for specifying a filename. 
      // It will automatically escape/replace punctuation characters.
      $downloadDataMenu = $('<a data-download-id="'+id+'" href="data/'+ (analyticsName ? analyticsName + "_" : "")+viz.name+'.csv" download="'+ chartTitleForDownload +'.csv">' + VizUtil.getMessage(lang, "Export Chart Data") + '</a>');
    }
  }

  // Add download menu dropdown if download is available.
  if ($downloadImgMenu || $downloadDataMenu) {
    var $downloadMenuDropdown = $('<div class="download-dropdown-menu"/>');
    $downloadMenuDropdown.append('<a href="#">\xa0</a>')
    var $downloadUl = $('<ul>'); 
    $downloadMenuDropdown.append($downloadUl)
    if ($downloadImgMenu) {
      $downloadUl.append($('<li>').append($downloadImgMenu))
    }
    if ($downloadDataMenu) {
      $downloadUl.append($('<li>').append($downloadDataMenu))
    }
    $toolbarDiv.append($downloadMenuDropdown);
  }

  // Full screen view support. 
  if (viz.options.marker !== "singlevalue") {

    // If the full screen view is open, re-render the chart in the screen too.
    // This is for resizing handling.
    var $existingVizDiv = $('div[data-preview-id="'+id+'"]');
    if ($existingVizDiv.length > 0) {
      viz.options.width = $existingVizDiv.width();
      viz.options.height= $existingVizDiv.height();
      _renderSingleViz($existingVizDiv, id, vizName, analyticsName, viz, null/*minHeight - we don't need this setting in the preview pane. */);
    } 
    // Full-screen toggle button.
    var $fullscBtn = $('div.full-screen-toggle-btn[data-toggle-id="'+id+'"]'); 
    if ($fullscBtn.length === 0) {
      $fullscBtn = $('<div data-toggle-id="'+id+'" class="full-screen-toggle-btn" aria-label="' + VizUtil.getMessage(lang, "Show in fullscreen") + '" data-microtip-position="bottom-left" role="tooltip"></div>');
      $fullscBtn.on("click", function(){

        // Reload the chart metadata for the interactive support on the server. 
        viz = window[objectName];
        annotation = viz.annotation;
        // If it is analytics, find the viz metadata in analytics json.
        if (/^analytics_/.test(id)) {
          if (viz.vizs[vizName]) {
            analyticsName = viz.name;
            viz = VizUtil.analyticify(viz.vizs[vizName].metadata);
          } else {
            // If no metadata found, just set viz to null. 
            // Usually it shouldn't happen but just in case it happens. #9689
            viz = null;
          }
        }

        var toggleId = $(this).attr("data-toggle-id");
        var $fullscDiv = $('<div class="full-screen-pane viz-container"></div>');
        var $vizDiv = $('<div data-preview-id="'+toggleId+'" class="full-screen-pane-inner"></div>');
        var $closeBtn = $('<div class="full-screen-close-btn"></div>');
        $closeBtn.on("click", function(){
          // Get back the original width and height.
          viz.options.width = viz.options._width;
          viz.options.height = viz.options._height;
          // Remove the full-screen dialog.
          $fullscDiv.remove();
        });
        $fullscDiv.append($vizDiv);
        $fullscDiv.append($closeBtn);
        $(document.body).append($fullscDiv);

        // Remenber the current width/height. 
        // We will get it back once the full-screen mode is closed.
        viz.options._width = viz.options.width;
        viz.options._height = viz.options.height;

        viz.options.width = $vizDiv.width();
        viz.options.height= $vizDiv.height();
        // Render a chart.
        _renderSingleViz($vizDiv, id, vizName, analyticsName, viz);
        // Update the links in the chart in the full-screen view.
        _enableLinks();
      });
      $toolbarDiv.append($fullscBtn);
    }
  }

  // Init show comment balloon.
  // We should do this once all the buttons are added to the toolbar
  // because the balloon alignment depends on the width of the toolbar.
  if ($commentBtn) {
    $commentBtn.balloon({
      contents: '<div class="title-area">'+VizUtil.getMessage(lang, "Comment")+'</div><div class="body-area">' + commentHtml + '</div>',
      html: true,
      position: "bottom left",
      classname: "comment-balloon",
      minLifetime: 0, showDuration: 0, hideDuration: 0,
      css: {
        transform: "translateX(" + ($toolbarDiv.width() - 10) + "px)",
        border: "1px solid #ddd",
        borderRadius: "2px",
        padding: "10px 16px",
        fontSize: "14px",
        fontWeight: "normal",
        backgroundColor: "#fff",
        color: "#666",
        boxShadow: "none",
        minWidth: "200px",
        zIndex: "1100",
        whiteSpace: "pre-wrap",
        borderRadius: "6px",
        opacity: "1",
        maxWidth: Math.min(400, ($div.outerWidth() - 20)) + "px",
      },
    });
}

  // Mark it as rendered.
  window._vizRenderingStatus[id] = true;
  _enableLinks();
  window.parent.postMessage(JSON.stringify({action:'SetRenderingStatus', renderingStatus: window._vizRenderingStatus}),'*');
}

// Track the viz rendering status. 
window._vizRenderingStatus = {};

// Render charts.
window._renderViz = function(){
  $vizs.each(function(index) {
    window._vizRenderingStatus[$(this).attr("data-id")] = false;
    setTimeout(_renderVizPanel.bind(this) ,50);
  });
};

// Show loading messages on charts. 
window._showLoading = function(){
  $vizs.each(function(index) {
    var dataId = $(this).attr("data-id");
    $('.viz-loading[data-id="'+dataId+'"]').show();
    $('div[data-id="div-'+dataId+'"]').hide();
  });
};

// Reload chart metadata. Used in Interactive mode.
window._reloadMetadata = function(baseUrl){
  // Save the base URL to the window object 
  // for R-based chart output rendering later.
  if (baseUrl) {
    window._baseUrl = 
      window.location.protocol + 
      "//" + 
      window.location.host + 
      baseUrl;
  }
  var cb = "?cb=" + Date.now();
  $vizs.each(function(index) {
    var analyticsId = $(this).attr("data-analysis"),
      vizId = $(this).attr("data-viz"),
      url = "";
    if (analyticsId) {
      url = baseUrl+"/note_content/libs/exploratory/analytics/"+analyticsId+".js" + cb;
    } else {
      url = baseUrl+"/note_content/libs/exploratory/layout/"+vizId+".js" + cb;
    }
    $(document.body).append('<script src="'  + url +'" />');
  });
};

// Render charts at loading time. 
window._renderViz();


</script>
<!-- END: Exploratory custom footer -->


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
